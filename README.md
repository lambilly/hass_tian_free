# 天聚数行免费版 Home Assistant 集成

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-orange.svg)](https://github.com/hacs/integration)

这是一个为 Home Assistant 开发的定制集成，用于从[天聚数行]获取各类文化资讯内容，包括早安晚安、唐诗、宋词、元曲、今日历史、英文格式，古籍警句等。免费版专为天聚数行普通会员（免费）定制使用。

## 🆓 为什么开发免费版？

由于天聚数行API普通会员最多只能申请10个免费API接口，为了让更广大的用户能够使用这些优质的文化内容，我们特别开发了这个免费版集成。

### 免费版特点：
- ✅ **完全免费** - 无需付费API密钥
- ✅ **精选内容** - 保留最受欢迎的10个API接口，除早安、晚安心语默认外，其他8个API可选，不必一次性申请10个API
- ✅ **独立实体** - 每个API对应一个独立传感器，便于使用
- ✅ **智能缓存** - 1小时缓存机制，避免API调用超限
- ✅ **滚动展示** - 根据设置的滚动间隔切换显示内容
- ✅ **定时展示** - 根据时间段智能切换显示内容

## 📋 包含内容

本集成包含以下12个传感器实体：

1. **每日笑话** - 轻松一刻，每日更新
2. **早安心语** - 温馨问候，美好一天
3. **晚安心语** - 温馨祝福，伴您入眠
4. **唐诗鉴赏** - 经典唐诗，文化瑰宝
5. **最美宋词** - 婉约豪放，词韵悠长
6. **精选元曲** - 戏曲精华，艺术传承
7. **简说历史** - 历史知识，温故知新
8. **古籍名句** - 经典名句，智慧结晶
9. **经典对联** - 传统对联，文化韵味
10. **英文格言** - 双语格言，启迪智慧
11. **滚动内容** - 滚动切换，全天展示
12. **时段内容** - 定时切换，全天展示

（** 其中早安心语、晚安心语、滚动内容、时段内容是固定的，其他的8个可选**）

## 🚀 安装

### 方法一：通过 HACS 安装（推荐）

1. 确保已安装 [HACS](https://hacs.xyz/)
2. 在 HACS 的 "Integrations" 页面，点击右上角的三个点菜单，选择 "Custom repositories"
3. 在弹出窗口中添加仓库地址：https://github.com/lambilly/hass_tian_free/ ，类别选择 "Integration"
4. 在 HACS 中搜索 "天聚数行免费版"
5. 点击下载
6. 重启 Home Assistant

### 方法二：手动安装

1. 下载整个 `tian_free` 文件夹
2. 将其放入 `custom_components` 目录
3. 重启 Home Assistant
4. 在集成页面添加「天聚数行免费版」

## ⚙️ 配置

1. 在 Home Assistant 中进入「配置」->「集成」
2. 点击「+ 添加集成」
3. 搜索「天聚数行免费版」
4. 输入您的天聚数行API密钥（32位）
5. 点击「提交」

## 🔧 API 密钥获取

1. 访问 [天聚数行官网](https://www.tianapi.com/)
2. 注册账号并登录
3. 在控制台申请免费API密钥
4. 每个账号可免费申请10个API接口

## 📊 实体属性

每个传感器实体都包含以下属性：
- `title`: 实体标题
- `code`: API返回状态码
- `update_time`: 最后更新时间
- 其他内容相关属性

## 📰卡片显示，需要在HACS安装：Lovelace HTML Jinja2 Template card 卡片
```yaml
type: custom:html-template-card
content: >
  {% set entity = 'sensor.gun_dong_nei_rong' %}<div style="color: white;"><p
  align="left"><h3 style="color: white; margin-bottom: 0px;">【{{
  state_attr(entity, 'title') }}】</h3><p align="{{ state_attr(entity,
  'subalign') }}" style="color: yellow; margin: 0px 0;"><b>{{ state_attr(entity,
  'subtitle') }}</b></p></div> <p align="{{ state_attr(entity, 'align') }}"
  style="color: white; font-size: 1.0em; margin-top: 10px;">{{
  state_attr(entity, 'content1') }}
```
## 🕒 时段内容传感器时段安排

滚动内容传感器会根据设置间隔切换显示内容(1-60分钟)：
时段内容传感器会根据时间段自动切换显示内容：

- **05:00-07:59** 🌅 早安问候
- **08:00-09:59** ☘️ 英文格言  
- **10:00-11:59** 🌻 每日笑话
- **12:00-13:59** 🌻 古籍名句
- **14:00-15:59** 🔖 经典对联
- **16:00-17:59** 🏷️ 简说历史
- **18:00-19:59** 🔖 唐诗鉴赏
- **20:00-21:59** 🌼 最美宋词
- **22:00-23:59** 🔖 精选元曲
- **00:00-04:59** 🌃 晚安问候

## 🔄 更新频率

- 所有传感器每天自动更新一次
- 缓存机制：1小时内重复调用使用缓存数据
- 支持手动立即更新

## 🐛 故障排除

### 常见问题

**Q: API密钥错误**
A: 请确认API密钥为32位字符串，且在天聚数行官网有效

**Q: 实体显示"API请求失败"**
A: 检查网络连接，确认API密钥有效且未超过调用限制

**Q: 滚动内容显示"等待数据加载"**
A: 首次安装需要等待所有传感器完成首次更新，或手动重新加载

**Q: 如何重新加载集成？**
A: 在开发者工具中点击"重新加载天聚数行免费版"

## 📄 许可证

本项目采用 MIT 许可证

## 🙏 致谢

感谢天聚数行提供的免费API服务

感谢 Home Assistant 社区

感谢所有贡献者和用户

## 🐛 问题反馈

如果您遇到任何问题或有改进建议，请在GitHub仓库中提交Issue。

---

**注意**: 本集成仅用于个人学习和非商业用途，请遵守天聚数行的API使用条款。
